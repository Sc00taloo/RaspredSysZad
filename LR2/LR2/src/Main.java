import mpi.*;

public class Main {
    public static void main(String[] args) {
        int myrank, size, message;
        int tag = 1;
        MPI.Init(args);
        myrank = MPI.COMM_WORLD.Rank();
        size = MPI.COMM_WORLD.Size();
        message = myrank;
        // ?????????? ??? ???????? ?????
        int s = 0;

        // ??????????? ?????
        for (int i = 0; i < size; i++) {
            // ???????? ? ????????? ????????
            int[] recvBuf = new int[1];
            System.out.println("????????? " + myrank + " ?????????? " + message + " ?????????? " + ((myrank + 1) % size));
            MPI.COMM_WORLD.Sendrecv(new int[]{message}, 0, 1, MPI.INT, (myrank + 1) % size, tag,
                    recvBuf, 0, 1, MPI.INT, (myrank - 1 + size) % size, tag);
            // ????????? ?????????? ????????
            s += recvBuf[0];
            // ????????? buf ??? ????????? ????????
            message = s;
            System.out.println("????????? " + myrank + " ??????? " + recvBuf[0] + " ?? ?????????? " + ((myrank - 1 + size) % size));
        }

        // ??????? ????????? ??????? ?????????
        if (myrank == 0) {
            System.out.println("Total sum: " + s);
        }

        MPI.Finalize();
    }
}

//public class Main {
//    public static void main(String[] args) {
//        MPI.Init(args);
//
//        int myrank = MPI.COMM_WORLD.Rank();
//        int size = MPI.COMM_WORLD.Size();
//        int tag = 1;
//
//        int buf = myrank;
//        int s = 0;
//
//        for (int i = 0; i < size; i++) {
//            int[] recvBuf = new int[1];
//            Request sendRequest = MPI.COMM_WORLD.Isend(new int[]{buf}, 0, 1, MPI.INT, (myrank + 1) % size, tag);
//            Request recvRequest = MPI.COMM_WORLD.Irecv(recvBuf, 0, 1, MPI.INT, (myrank - 1 + size) % size, tag);
//            // ???????? ?????????? ????????
//            sendRequest.Wait();
//            recvRequest.Wait();
//            s += recvBuf[0];
//            buf = s;
//        }
//
//        if (myrank == 0) {
//            System.out.println("Total sum: " + s);
//        }
//
//        MPI.Finalize();
//    }
//}